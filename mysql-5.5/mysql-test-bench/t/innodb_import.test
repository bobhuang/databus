source include/master-slave.inc;
let $destdir = $MYSQLTEST_VARDIR/tmp/xtrabackup;
connection slave;
let $slave_datadir = `select @@datadir`;
use test;
create table t1 (k bigint not null primary key, v blob) 
  engine=innodb row_format=compressed;
insert into t1 values (1,'one'),(2,'two'),(3,'three');  
create table t2 (k bigint not null primary key, v blob) 
  engine=innodb row_format=compressed;
insert into t2 values (1,'one'),(2,'two'),(3,'three');
sleep 20;  
--exec mkdir -p $destdir  
--exec xtrabackup --no-defaults --backup --target-dir=$destdir --datadir=$slave_datadir --tables=test.t1 --innodb-data-home-dir=$slave_datadir --innodb-log-group-home-dir=$slave_datadir >> $destdir/xtrabackup.log
--exec xtrabackup --no-defaults --prepare --export --innodb-file-per-table --target-dir=$destdir --tables=test.t1 --datadir=$slave_datadir >> $destdir/xtrabackup.log

drop table t1,t2;
connection master;
let $master_datadir=`select @@datadir`;
set sql_log_bin=0;
set global innodb_expand_import=1;
create table t1 (k bigint not null primary key, v blob) 
  engine=innodb row_format=compressed;
alter table t1 discard tablespace;
--exec cp $destdir/test/t1.* $master_datadir/test/
alter table t1 import tablespace;
select * from t1;
set global innodb_expand_import=0;
drop table t1;

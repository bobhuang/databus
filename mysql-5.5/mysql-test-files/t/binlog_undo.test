source include/master-slave.inc;
use test;
CREATE TABLE `EmailTest` (
  `mboxid` int(11) NOT NULL,
  `docid` int(11) NOT NULL,
  `timestamp` bigint(20) NOT NULL,
  `etag` varchar(10) NOT NULL,
  `val` blob,
  `schema_version` smallint(6) NOT NULL,
  PRIMARY KEY (`mboxid`,`docid`)
) ENGINE=INNODB;

insert into EmailTest values (10,100, 1000, 'one', 'One one', 1);
insert into EmailTest values (20,200, 2000, 'two', 'Two two', 2);
insert into EmailTest values (30,300, 3000, 'three', 'Three three', 3);
update EmailTest set val = 'New one' where mboxid = 10 and docid = 100;
update EmailTest set val = 'New two' where mboxid = 20 and docid = 200;
delete from EmailTest where mboxid = 30 and docid = 300;
insert into EmailTest values (31,300, 3000, 'three', 'Three three', 3),
 (20,400, 2000, 'two', 'Two four', 2);
begin;
insert into EmailTest values (40,300, 3000, 'four', 'Four four', 3);
update EmailTest set val = 'New four' where mboxid = 40 and docid = 300;
update EmailTest set val = 'New three' where mboxid >= 30;

commit;
select * from EmailTest; 
set sql_log_bin=0;
select binlog_undo_event('master.000001',2625);
select * from EmailTest; 
select binlog_undo_event('master.000001',2035);
select * from EmailTest; 
select binlog_undo_event('master.000001',1785);
select * from EmailTest; 
select binlog_undo_event('master.000001',1231);
select * from EmailTest; 
select binlog_undo_event('master.000001',556);
select binlog_undo_event('master.000001',493);
select * from EmailTest; 
select binlog_undo_event('master.000001',557);
select binlog_undo_event('master.000001',417);

set sql_log_bin = 1;

show binlog events;
show open tables;
drop table EmailTest;
source include/master-slave.inc;
connection master;
drop database if exists foo;
create database foo;
select set_binlog_seq_id("foo",3),set_binlog_gen_id("foo",3);
drop database foo;
create database foo;
select set_binlog_seq_id("foo",3),set_binlog_gen_id("foo",3);
create table foo.t1 (n int) engine=innodb;
drop database foo;
select get_binlog_gen_id("test");
select set_binlog_gen_id("test", 12345);
use test;
select get_binlog_gen_id("test");
select get_binlog_seq_id("test");
create table t1(n int) engine=innodb;
set @binlog_group_id:=123;
insert into t1 values(11),(12),(13);
set @binlog_group_id:=223;
insert into t1 values(21),(22),(23);
set @binlog_group_id:=0;
insert into t1 values(31),(32),(33);
insert into t1 values(41),(42),(43);
create database d1;
select get_binlog_seq_id("test");
select set_binlog_seq_id("test",12345);
select get_binlog_seq_id("test");
select set_binlog_gen_id("d1",212345);
use d1;     
select get_binlog_gen_id("test");
select get_binlog_gen_id("d1");
create table t1(n int) engine=innodb;
insert into t1 values(111),(112),(113);
insert into t1 values(121),(122),(123);
insert into t1 values(131),(132),(133);
insert into t1 values(141),(142),(143);
create database d2;
use d2;
create table t1(n int) engine=innodb;
insert into t1 values(211),(212),(213);
insert into t1 values(221),(222),(223);
create database exp_d1;
use exp_d1;
select set_binlog_gen_id("exp_d1",256);
use exp_d1;
create table t1(n int) engine=innodb;
insert into t1 values(1),(2),(3);

-- write_file $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
wait
EOF

-- shutdown_server 10
-- source include/wait_until_disconnected.inc

--echo --> Start master server
--append_file $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
restart
EOF
--enable_reconnect
--source include/wait_until_connected_again.inc

insert into t1 values(231),(232),(233);
insert into t1 values(241),(242),(243);

begin;
insert into t1 values(241),(242),(243);
insert into t1 values(251),(252),(253);
insert into t1 values(261),(262),(263);
commit;
show binlog events;
sync_slave_with_master;
connection slave;
use test;
select * from t1;
connection master;
use test;
drop table t1;
drop database d1;
drop database d2;
drop database exp_d1;
sync_slave_with_master;

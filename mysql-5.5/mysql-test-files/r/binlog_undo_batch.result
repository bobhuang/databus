stop slave;
drop table if exists t1,t2,t3,t4,t5,t6,t7,t8,t9;
reset master;
reset slave;
drop table if exists t1,t2,t3,t4,t5,t6,t7,t8,t9;
start slave;
select binlog_undo_batch("db1",1);
ERROR 42000: Incorrect parameter count in the call to native function 'binlog_undo_batch'
set_binlog_gen_id("d10",1)
0
set_binlog_seq_id("d10",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d9",1)
0
set_binlog_seq_id("d9",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d8",1)
0
set_binlog_seq_id("d8",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d7",1)
0
set_binlog_seq_id("d7",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d6",1)
0
set_binlog_seq_id("d6",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d5",1)
0
set_binlog_seq_id("d5",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d4",1)
0
set_binlog_seq_id("d4",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d3",1)
0
set_binlog_seq_id("d3",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d2",1)
0
set_binlog_seq_id("d2",1)
0
select count(*) from EmailTest;
count(*)
1010
set_binlog_gen_id("d1",1)
0
set_binlog_seq_id("d1",1)
0
select count(*) from EmailTest;
count(*)
1010
@gen_id:=get_binlog_gen_id("d4")	@seq_id:=get_binlog_seq_id("d4")
1	12
binlog_undo_batch("d1",1,1,"d2",1,2,"d3",1,3,"d4",1,4,
"d10",1,10)
0
@gen_id:=get_binlog_gen_id("d4")	@seq_id:=get_binlog_seq_id("d4")
1	12
use d10;
select count(*) from EmailTest;
count(*)
1008
use d9;
select count(*) from EmailTest;
count(*)
1010
use d8;
select count(*) from EmailTest;
count(*)
1010
use d7;
select count(*) from EmailTest;
count(*)
1010
use d6;
select count(*) from EmailTest;
count(*)
1010
use d5;
select count(*) from EmailTest;
count(*)
1010
use d4;
select count(*) from EmailTest;
count(*)
1002
use d3;
select count(*) from EmailTest;
count(*)
1001
use d2;
select count(*) from EmailTest;
count(*)
1000
use d1;
select count(*) from EmailTest;
count(*)
0
use d4;
select @gen_id:=get_binlog_gen_id("d4"),@seq_id:=get_binlog_seq_id("d4");
@gen_id:=get_binlog_gen_id("d4")	@seq_id:=get_binlog_seq_id("d4")
1	12
delete from EmailTest where docId > 10;
select * from EmailTest;
mboxid	docid	timestamp	etag	val	schema_version
4	1	1000	4	4 14 14 14 1	1
4	2	1000	4	4 24 24 24 2	1
4	3	1000	4	4 34 34 34 3	1
4	4	1000	4	4 44 44 44 4	1
4	5	1000	4	4 54 54 54 5	1
4	6	1000	4	4 64 64 64 6	1
4	7	1000	4	4 74 74 74 7	1
4	8	1000	4	4 84 84 84 8	1
4	9	1000	4	4 94 94 94 9	1
4	10	1000	4	4 104 104 104 10	1
10004	9	1000	4	4 94 94 94 9	1
10004	10	1000	4	4 104 104 104 10	1
select @gen_id:=get_binlog_gen_id("d4"),@seq_id:=get_binlog_seq_id("d4");
@gen_id:=get_binlog_gen_id("d4")	@seq_id:=get_binlog_seq_id("d4")
1	13
update EmailTest set docId = docid + 100;
update EmailTest set mboxid = mboxid + 30;
delete from EmailTest where mboxid = 34;
insert into EmailTest values(300,3000,2000,'foo','foo foo',2);
select * from EmailTest;
mboxid	docid	timestamp	etag	val	schema_version
300	3000	2000	foo	foo foo	2
10034	109	1000	4	4 94 94 94 9	1
10034	110	1000	4	4 104 104 104 10	1
select binlog_undo_batch("d4",@gen_id,@seq_id);
binlog_undo_batch("d4",@gen_id,@seq_id)
0
select * from EmailTest;
mboxid	docid	timestamp	etag	val	schema_version
4	1	1000	4	4 14 14 14 1	1
4	2	1000	4	4 24 24 24 2	1
4	3	1000	4	4 34 34 34 3	1
4	4	1000	4	4 44 44 44 4	1
4	5	1000	4	4 54 54 54 5	1
4	6	1000	4	4 64 64 64 6	1
4	7	1000	4	4 74 74 74 7	1
4	8	1000	4	4 84 84 84 8	1
4	9	1000	4	4 94 94 94 9	1
4	10	1000	4	4 104 104 104 10	1
10004	9	1000	4	4 94 94 94 9	1
10004	10	1000	4	4 104 104 104 10	1
drop database d10;
drop database d9;
drop database d8;
drop database d7;
drop database d6;
drop database d5;
drop database d4;
drop database d3;
drop database d2;
drop database d1;

#!/bin/bash 

export TEST_NAME=perfdb_liar.test

source setup_env.inc

#***************************************************************************************************************************************
#all ${ALL_CAPS} type vars come from setup_env.inc(except TEST_NAME)...check that file first before introducing any new variables here
#***************************************************************************************************************************************
relay_port=${RELAY_PORT_BASE}
bootstrap_producer_port=${BOOTSTRAP_PRODUCER_PORT_BASE}
bootstrap_server_port=${BOOTSTRAP_SERVER_PORT_BASE}
client_port=${CLIENT_PORT_BASE}

db_config_file=config/sources-liar-perfdb.json 
relay_event_trace=$WORK_DIR_FROM_ROOT/profile_relay_event_trace

# test liar db relay can run with a small buffer.

#$SCRIPT_DIR/dbus2_driver.py -c db_relay -o start -p $CONFIG_DIR/relay-config-small-1.properties --db_config_file=${db_config_file}
$SCRIPT_DIR/dbus2_driver.py -n $TEST_NAME -c db_relay -o start  --db_config_file=${db_config_file} --cmdline_props="databus.relay.container.id=1234;databus.relay.eventBuffer.maxSize=10240000;databus.relay.eventBuffer.readBufferSize=1024000;databus.relay.eventBuffer.scnIndexSize=1024000;databus.relay.eventBuffer.trace.option=file;databus.relay.eventBuffer.trace.filename=${relay_event_trace};databus.relay.eventBuffer.trace.appendOnly=false;databus.bootstrap.client.runtime.relay(1).port=${relay_port}" -l config/client-log4j2file.properties.debug

$SCRIPT_DIR/dbus2_gen_event.py --db_gen -s liar --db_testdata_insert --db_config_file=${db_config_file} --num_events=50 --from_scn=1 --server_port=${relay_port}





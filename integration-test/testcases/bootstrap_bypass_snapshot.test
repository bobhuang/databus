#!/bin/bash

report() {
   msg="$1"
   stat="$2"
   if [ $stat == 0 ]; then
     echo $msg SUCCESS;
   else
     echo $msg FAILURE;
   fi
   return;
}

export TEST_NAME=bootstrap_bypass_snapshot.test

# sets up common environmnet variables and 
source setup_env.inc

stat_txt="catchup_positive_one_log"
./bootstrap_bypass_snapshot_template.test catchup_positive_one_log
source report_pass_fail.inc
result_catchup_positive_one_log=$all_stat;

all_stat=0;
stat_txt="catchup_positive_multiple_logs"
./bootstrap_bypass_snapshot_template.test catchup_positive_multiple_logs
source report_pass_fail.inc
result_catchup_positive_multiple_logs=$all_stat

all_stat=0;
stat_txt="catchup_negative_full_bootstrap"
./bootstrap_bypass_snapshot_template.test catchup_negative_full_bootstrap
source report_pass_fail.inc
result_catchup_negative_full_bootstrap=$all_stat

all_stat=0;
stat_txt="catchup_negative_purged"
./bootstrap_bypass_snapshot_template.test catchup_negative_purged
source report_pass_fail.inc
result_catchup_negative_purged=$all_stat

all_stat=0;
stat_txt="catchup_negative_threshold_check_fail"
./bootstrap_bypass_snapshot_template.test catchup_negative_threshold_check_fail
source report_pass_fail.inc
result_catchup_negative_threshold_check_fail=$all_stat 

save_stat=`expr $result_catchup_positive_one_log + $result_catchup_positive_multiple_logs + $result_catchup_negative_full_bootstrap + $result_catchup_negative_purged + $result_catchup_negative_threshold_check_fail`

# Print Results
all_stat=$result_catchup_positive_one_log
stat_txt="catchup_positive_one_log"
source report_pass_fail.inc
report "$stat_txt" "$all_stat"

all_stat=$result_catchup_positive_multiple_logs
stat_txt="catchup_positive_multiple_logs"
report "$stat_txt" "$all_stat"

all_stat=$result_catchup_negative_full_bootstrap
stat_txt="catchup_negative_full_bootstrap"
report "$stat_txt" "$all_stat"

all_stat=$result_catchup_negative_purged
stat_txt="catchup_negative_purged"
report "$stat_txt" "$all_stat"

all_stat=$result_catchup_negative_threshold_check_fail
stat_txt="catchup_negative_threshold_check_fail"
report "$stat_txt" "$all_stat"

all_stat=$save_stat
stat_txt="bootstrap_bypass_snapshot"
report "$stat_txt" "$all_stat"

stat_txt="Relay Pull Thread Validation"
cat ${VIEW_ROOT}/${WORK_DIR_FROM_ROOT}/*log* | perl $SCRIPT_DIR/validateRelayPullerMessageQueue.pl
source report_pass_fail.inc

echo "all_stat is : $all_stat"
exit $all_stat;
